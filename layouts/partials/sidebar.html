{{- if site.Taxonomies.tags }}
<div class="sidebar-section">
  <h3>タグ</h3>
  <div class="tag-cloud">
    {{- range $name, $taxonomy := site.Taxonomies.tags }}
    <a href="{{ "/tags/" | relLangURL }}{{ $name | urlize }}" class="tag-link">
      {{ $name | humanize }} ({{ $taxonomy.Count }})
    </a>
    {{- end }}
  </div>
</div>
{{- end }}

{{- $pages := where site.RegularPages "Type" "in" site.Params.mainSections }}
{{- if $pages }}
<div class="sidebar-section">
  <h3>アーカイブ</h3>
  <div class="archive-list">
    {{- range ($pages.GroupByDate "2006-01") }}
    {{- $monthKey := .Key }}
    {{- $monthDate := index .Pages 0 }}
    <a href="#" 
       class="archive-link" 
       data-month="{{ $monthKey }}"
       onclick="filterByMonth('{{ $monthKey }}'); return false;">
      {{ $monthDate.Date.Format "2006年1月" }} ({{ len .Pages }})
    </a>
    {{- end }}
  </div>
</div>
{{- end }}

<style>
.sidebar-section {
  margin-bottom: 2rem;
  padding: 1rem;
  border: 1px solid var(--border);
  border-radius: 8px;
}

.sidebar-section h3 {
  margin-bottom: 1rem;
  color: var(--primary);
  border-bottom: 1px solid var(--border);
  padding-bottom: 0.5rem;
}

.tag-cloud {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.tag-link {
  padding: 0.25rem 0.5rem;
  background: var(--code-bg);
  color: var(--primary);
  text-decoration: none;
  border-radius: 4px;
  font-size: 0.9rem;
  transition: background-color 0.3s ease;
}

.tag-link:hover {
  background: var(--border);
}

.archive-list {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.archive-link {
  padding: 0.5rem;
  color: var(--primary);
  text-decoration: none;
  border-radius: 4px;
  transition: background-color 0.3s ease;
}

.archive-link:hover {
  background: var(--code-bg);
}

.archive-link.active {
  background: var(--primary);
  color: var(--theme);
}
</style>

<script>
function filterByMonth(month) {
  // 現在の URL を更新して月でフィルタリング
  const url = new URL(window.location);
  url.searchParams.set('month', month);
  window.location.href = url.toString();
}

// ページ読み込み時に月パラメータをチェック
document.addEventListener('DOMContentLoaded', function() {
  const urlParams = new URLSearchParams(window.location.search);
  const selectedMonth = urlParams.get('month');
  
  if (selectedMonth) {
    // アクティブなアーカイブリンクをハイライト
    const archiveLinks = document.querySelectorAll('.archive-link');
    archiveLinks.forEach(link => {
      if (link.dataset.month === selectedMonth) {
        link.classList.add('active');
      } else {
        link.classList.remove('active');
      }
    });
  }
});
</script>